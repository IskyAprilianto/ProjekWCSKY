<%- include('partials/header') %>

<div class="article-detail-container">
  <article class="article-full">
    <header class="article-header">
      <h1 class="article-title-detail"><%= article.title %></h1>
      <div class="article-meta">
        <span class="meta-category"><%= article.category %></span>
        <span class="meta-date"
          >Dipublikasikan pada <%= new
          Date(article.createdAt).toLocaleDateString('id-ID', { day: 'numeric',
          month: 'long', year: 'numeric' }) %></span
        >
      </div>
    </header>
    <img
      src="<%= article.imageUrl %>"
      alt="<%= article.title %>"
      class="article-image-detail"
    />
    <div class="article-content">
      <%- article.content.replace(/\n/g, '<br />') %>
    </div>
  </article>

  <section class="comment-section">
    <h3>Diskusi</h3>
    <% if (user) { %>
    <div class="comment-form">
      <form action="/artikel/<%= article.slug %>/comments" method="POST">
        <div class="form-group">
          <label for="comment-content">Tulis Komentar Baru</label>
          <textarea
            name="content"
            id="comment-content"
            rows="4"
            required
            placeholder="Bagikan pendapat Anda..."
          ></textarea>
        </div>
        <button type="submit" class="btn">Kirim Komentar</button>
      </form>
    </div>
    <% } else { %>
    <p class="comment-login-prompt">
      Silakan <a href="/login">login</a> untuk berkomentar atau membalas.
    </p>
    <% } %>

    <div class="comment-list" id="comment-list">
      <% if (comments.length > 0) { %> <% comments.forEach(function(comment) {
      %> <%- include('partials/_comment', { comment: comment, article: article,
      user: user, level: 0 }) %> <% }) %> <% } else { %>
      <p>Belum ada komentar. Jadilah yang pertama!</p>
      <% } %>
    </div>
  </section>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const commentList = document.getElementById("comment-list");

    if (commentList) {
      commentList.addEventListener("click", function (event) {
        // Hanya jalankan jika yang diklik adalah tombol dengan kelas .btn-reply atau .btn-show-replies
        if (event.target.matches(".btn-reply, .btn-show-replies")) {
          event.preventDefault(); // Mencegah link '#' melompat ke atas
          const targetId = event.target.dataset.target;
          const targetElement = document.getElementById(targetId);

          if (targetElement) {
            // Logika buka-tutup (toggle)
            const isHidden =
              targetElement.style.display === "none" ||
              targetElement.style.display === "";
            targetElement.style.display = isHidden ? "block" : "none";
          }
        }
      });
    }
  });
</script>

<%- include('partials/footer') %>
